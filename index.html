<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Universe Elite Pro</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>
    
    <style>
        :root { --main: #0088cc; --bg: #f0f2f5; --text: #000; --msg-mine: #dcf8c6; --msg-others: #fff; }
        body.dark-mode { --bg: #0b141a; --text: #fff; --msg-mine: #005c4b; --msg-others: #202c33; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: sans-serif; }
        body { background: var(--bg); color: var(--text); display: flex; justify-content: center; height: 100vh; transition: 0.3s; }
        .container { width: 100%; max-width: 500px; background: #fff; height: 100vh; display: flex; flex-direction: column; position: relative; overflow: hidden; }
        body.dark-mode .container { background: #111b21; }

        /* –í—Ö–æ–¥ */
        #login-screen { padding: 40px; display: flex; flex-direction: column; gap: 15px; height: 100%; justify-content: center; text-align: center; }
        input { padding: 12px; border-radius: 10px; border: 1px solid #ccc; outline: none; }
        .btn { padding: 12px; background: var(--main); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; }

        /* –ß–∞—Ç */
        header { background: #ededed; padding: 12px 15px; display: flex; align-items: center; justify-content: space-between; }
        body.dark-mode header { background: #202c33; }
        #messages { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; background: #e5ddd5; }
        body.dark-mode #messages { background: #0b141a; }
        .msg { padding: 8px 12px; border-radius: 10px; max-width: 80%; position: relative; background: var(--msg-others); box-shadow: 0 1px 1px rgba(0,0,0,0.1); }
        .msg.mine { align-self: flex-end; background: var(--msg-mine); }
        .input-bar { padding: 10px; background: #f0f2f5; display: flex; gap: 8px; }
        body.dark-mode .input-bar { background: #202c33; }
    </style>
</head>
<body>

<div class="container">
    <div id="login-screen">
        <h1>Universe Elite</h1>
        <p>–í—Ö–æ–¥ –ø–æ –∏–º–µ–Ω–∏ (—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∑–∞–ø–æ–º–Ω–∏—Ç –≤–∞—Å)</p>
        <input type="text" id="username" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–∏–∫">
        <button class="btn" onclick="auth()">–í–æ–π—Ç–∏</button>
    </div>

    <div id="chat-screen" style="display:none; height:100%; flex-direction:column;">
        <header>
            <b id="header-user">–ß–∞—Ç</b>
            <div>
                <button onclick="toggleDarkMode()" style="background:none; border:none; cursor:pointer; font-size:1.2rem;">üåì</button>
                <button id="admin-btn" onclick="adminBroadcast()" style="display:none; background:none; border:none; cursor:pointer; margin-left:10px;">üì¢</button>
                <button onclick="logout()" style="background:none; border:none; cursor:pointer; margin-left:10px;">üö™</button>
            </div>
        </header>
        <div id="messages"></div>
        <div class="input-bar">
            <input type="text" id="msg-input" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." style="flex:1" onkeypress="if(event.key==='Enter') send()">
            <button class="btn" onclick="send()">‚û§</button>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "–¢–í–û–ô_API_KEY",
        databaseURL: "–¢–í–û–ô_DATABASE_URL",
        projectId: "–¢–í–û–ô_PROJECT_ID",
        storageBucket: "–¢–í–û–ô_STORAGE_BUCKET"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const ADMIN_ID = "6739218"; // –ò–º—è –∞–¥–º–∏–Ω–∞
    let currentUser = localStorage.getItem('chat_user');

    if (currentUser) loginSuccess(currentUser);

    function auth() {
        const u = document.getElementById('username').value.trim();
        if (!u) return alert("–í–≤–µ–¥–∏—Ç–µ –∏–º—è!");
        
        localStorage.setItem('chat_user', u);
        loginSuccess(u);
    }

    function loginSuccess(u) {
        currentUser = u;
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('chat-screen').style.display = 'flex';
        document.getElementById('header-user').innerText = (u === ADMIN_ID) ? "–í—ã: –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†" : "–í—ã: " + u;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Ä–∞—Å—Å—ã–ª–∫–∏ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—É
        if (u === ADMIN_ID) {
            document.getElementById('admin-btn').style.display = 'inline-block';
        }

        loadMessages();
        if(localStorage.getItem('theme') === 'dark') document.body.classList.add('dark-mode');
    }

    function loadMessages() {
        db.ref('messages').on('value', snap => {
            const area = document.getElementById('messages');
            area.innerHTML = '';
            snap.forEach(m => {
                const d = m.val();
                const isMine = d.s === currentUser;
                const div = document.createElement('div');
                div.className = `msg ${isMine ? 'mine' : ''}`;
                div.innerHTML = `<small><b>${d.s === ADMIN_ID ? '‚≠ê –ê–î–ú–ò–ù' : d.s}</b></small><br>${d.t}`;
                
                // –ê–¥–º–∏–Ω –∏–ª–∏ –≤–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –¥–æ–ª–≥–∏–º –Ω–∞–∂–∞—Ç–∏–µ–º / –ø—Ä–∞–≤—ã–º –∫–ª–∏–∫–æ–º
                div.oncontextmenu = (e) => {
                    e.preventDefault();
                    if (currentUser === ADMIN_ID || isMine) {
                        if (confirm("–£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ?")) db.ref('messages/' + m.key).remove();
                    }
                };
                area.appendChild(div);
            });
            area.scrollTop = area.scrollHeight;
        });
    }

    function send() {
        const input = document.getElementById('msg-input');
        const text = input.value.trim();
        if (!text) return;

        db.ref('messages').push({
            s: currentUser,
            t: text,
            ts: Date.now()
        });
        input.value = '';
    }

    async function adminBroadcast() {
        const msg = prompt("–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Ä–∞—Å—Å—ã–ª–∫–∏ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:");
        if (!msg) return;

        // –í —ç—Ç–æ–º –ø—Ä–æ—Å—Ç–æ–º —á–∞—Ç–µ —Ä–∞—Å—Å—ã–ª–∫–∞ –∏–¥–µ—Ç –≤ –æ–±—â–∏–π –∫–∞–Ω–∞–ª –æ—Ç –∏–º–µ–Ω–∏ —Å–∏—Å—Ç–µ–º—ã
        db.ref('messages').push({
            s: "–°–ò–°–¢–ï–ú–ê",
            t: "üì¢ –û–ë–™–Ø–í–õ–ï–ù–ò–ï: " + msg,
            ts: Date.now()
        });
        alert("–û–±—ä—è–≤–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!");
    }

    function toggleDarkMode() {
        document.body.classList.toggle('dark-mode');
        localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
    }

    function logout() {
        localStorage.removeItem('chat_user');
        location.reload();
    }
</script>
</body>
</html>
